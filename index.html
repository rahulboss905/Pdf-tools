<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Master Pro | Professional PDF Tools</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #7209b7;
            --accent: #f72585;
            --success: #4cc9f0;
            --warning: #ff9e00;
            --danger: #f94144;
            --light: #f8f9fa;
            --dark: #212529;
            --gray-100: #f8f9fa;
            --gray-200: #e9ecef;
            --gray-300: #dee2e6;
            --gray-400: #ced4da;
            --gray-500: #adb5bd;
            --gray-600: #6c757d;
            --gray-700: #495057;
            --gray-800: #343a40;
            --gray-900: #212529;
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 8px rgba(0,0,0,0.12);
            --shadow-lg: 0 8px 16px rgba(0,0,0,0.15);
            --shadow-xl: 0 12px 24px rgba(0,0,0,0.2);
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: var(--gray-800);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .main-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 20px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: var(--radius-xl);
            color: white;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }

        .main-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><path d="M0,0 L100,0 L100,100 Z" fill="white" opacity="0.1"/></svg>');
        }

        .main-header h1 {
            font-size: 2.8rem;
            font-weight: 700;
            margin-bottom: 10px;
            letter-spacing: -0.5px;
            position: relative;
            z-index: 1;
        }

        .main-header .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
            font-weight: 400;
            position: relative;
            z-index: 1;
        }

        .version-badge {
            display: inline-block;
            background: var(--accent);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-left: 10px;
            vertical-align: middle;
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            background: white;
            padding: 12px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
        }

        .nav-tab {
            display: flex;
            align-items: center;
            gap: 10px;
            background: var(--gray-100);
            color: var(--gray-700);
            border: 2px solid transparent;
            padding: 14px 24px;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: var(--transition);
            flex: 1;
            justify-content: center;
            min-width: 180px;
        }

        .nav-tab:hover {
            background: var(--gray-200);
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }

        .nav-tab.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary-dark);
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.3);
        }

        .nav-tab i {
            font-size: 1.2rem;
        }

        /* Main Content */
        .main-content {
            background: white;
            border-radius: var(--radius-xl);
            padding: 40px;
            box-shadow: var(--shadow-xl);
            margin-bottom: 40px;
            min-height: 600px;
        }

        .tab-pane {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .tab-pane.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Section Headers */
        .section-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--gray-200);
        }

        .section-header h2 {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--dark);
            margin: 0;
        }

        .section-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.4rem;
            box-shadow: var(--shadow-md);
        }

        /* Upload Areas */
        .upload-section {
            margin-bottom: 30px;
        }

        .upload-area {
            border: 3px dashed var(--gray-300);
            border-radius: var(--radius-lg);
            padding: 50px 30px;
            text-align: center;
            background: var(--gray-100);
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .upload-area:hover {
            border-color: var(--primary);
            background: var(--gray-200);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .upload-area.dragover {
            border-color: var(--success);
            background: rgba(76, 201, 240, 0.1);
        }

        .upload-icon {
            font-size: 3.5rem;
            color: var(--primary);
            margin-bottom: 20px;
        }

        .upload-text {
            font-size: 1.1rem;
            color: var(--gray-700);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .upload-subtext {
            color: var(--gray-600);
            font-size: 0.95rem;
        }

        .upload-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--primary);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        input[type="file"] {
            display: none;
        }

        /* File Lists */
        .file-list-container {
            margin-top: 20px;
        }

        .file-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .file-list-header h4 {
            font-size: 1.1rem;
            color: var(--gray-800);
            font-weight: 600;
        }

        .file-count {
            background: var(--gray-200);
            color: var(--gray-700);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .file-list {
            background: var(--gray-100);
            border-radius: var(--radius-md);
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: white;
            border-radius: var(--radius-sm);
            margin-bottom: 10px;
            border-left: 4px solid var(--primary);
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
        }

        .file-item:hover {
            transform: translateX(5px);
            box-shadow: var(--shadow-md);
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .file-icon {
            color: var(--primary);
            font-size: 1.2rem;
        }

        .file-name {
            font-weight: 500;
            color: var(--gray-800);
            word-break: break-all;
        }

        .file-size {
            color: var(--gray-600);
            font-size: 0.85rem;
            margin-top: 2px;
        }

        .file-actions {
            display: flex;
            gap: 8px;
        }

        .btn-remove {
            background: var(--danger);
            color: white;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-remove:hover {
            background: #d32f2f;
            transform: rotate(90deg);
        }

        /* Form Controls */
        .form-section {
            margin-bottom: 30px;
            padding: 25px;
            background: var(--gray-100);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
        }

        .form-section-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--gray-300);
        }

        .form-section-title h4 {
            font-size: 1.2rem;
            color: var(--gray-800);
            font-weight: 600;
            margin: 0;
        }

        .form-section-title i {
            color: var(--primary);
            font-size: 1.3rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--gray-700);
            font-weight: 500;
            font-size: 0.95rem;
        }

        .form-label i {
            color: var(--primary);
            margin-right: 8px;
        }

        .form-control {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--gray-300);
            border-radius: var(--radius-md);
            font-size: 1rem;
            transition: var(--transition);
            background: white;
            color: var(--gray-800);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .form-control::placeholder {
            color: var(--gray-500);
        }

        /* Range Slider */
        .range-group {
            position: relative;
            padding-top: 8px;
        }

        .range-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .range-value {
            background: var(--primary);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            background: var(--gray-300);
            border-radius: 4px;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            background: var(--primary);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: var(--shadow-md);
            border: 3px solid white;
        }

        input[type="range"]::-moz-range-thumb {
            width: 22px;
            height: 22px;
            background: var(--primary);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: var(--shadow-md);
            border: 3px solid white;
        }

        /* Radio and Checkbox */
        .radio-group, .checkbox-group {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .radio-option, .checkbox-option {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .radio-option input[type="radio"],
        .checkbox-option input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: var(--primary);
        }

        /* Color Picker */
        .color-picker-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        input[type="color"] {
            width: 60px;
            height: 60px;
            border: 3px solid var(--gray-300);
            border-radius: var(--radius-md);
            cursor: pointer;
            padding: 0;
        }

        /* Preview */
        .preview-container {
            background: white;
            border-radius: var(--radius-md);
            padding: 20px;
            border: 2px solid var(--gray-200);
            margin-bottom: 20px;
        }

        .preview-label {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 15px;
            color: var(--gray-700);
            font-weight: 500;
        }

        .preview-box {
            min-height: 200px;
            background: white;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background-image: 
                linear-gradient(45deg, #f0f0f0 25%, transparent 25%, transparent 75%, #f0f0f0 75%, #f0f0f0),
                linear-gradient(45deg, #f0f0f0 25%, transparent 25%, transparent 75%, #f0f0f0 75%, #f0f0f0);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
        }

        /* Progress Bar */
        .progress-container {
            margin: 25px 0;
            display: none;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .progress-label {
            font-weight: 500;
            color: var(--gray-700);
        }

        .progress-percent {
            font-weight: 600;
            color: var(--primary);
        }

        .progress-bar {
            height: 12px;
            background: var(--gray-200);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 6px;
            transition: width 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            width: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Buttons */
        .btn-container {
            text-align: center;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid var(--gray-200);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border: none;
            padding: 18px 45px;
            border-radius: var(--radius-lg);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 6px 20px rgba(67, 97, 238, 0.3);
            display: inline-flex;
            align-items: center;
            gap: 12px;
            letter-spacing: 0.5px;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(67, 97, 238, 0.4);
        }

        .btn-primary:active:not(:disabled) {
            transform: translateY(-1px);
        }

        .btn-primary:disabled {
            background: var(--gray-400);
            cursor: not-allowed;
            box-shadow: none;
            transform: none !important;
        }

        /* Status Messages */
        .status-container {
            margin-top: 25px;
        }

        .status-message {
            padding: 18px 20px;
            border-radius: var(--radius-md);
            display: none;
            align-items: center;
            gap: 15px;
            font-weight: 500;
            box-shadow: var(--shadow-sm);
        }

        .status-message.show {
            display: flex;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .status-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }

        .status-info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid #17a2b8;
        }

        .status-icon {
            font-size: 1.3rem;
        }

        /* Batch Processing */
        .batch-section {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            border-radius: var(--radius-lg);
            padding: 25px;
            margin-bottom: 25px;
            border: 2px solid var(--primary);
            position: relative;
        }

        .batch-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .batch-header h4 {
            color: var(--primary);
            font-size: 1.2rem;
            margin: 0;
        }

        .batch-badge {
            background: var(--accent);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .mode-switcher {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .mode-btn {
            padding: 12px 24px;
            border: 2px solid var(--gray-300);
            background: white;
            border-radius: var(--radius-md);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
            justify-content: center;
        }

        .mode-btn:hover {
            border-color: var(--primary);
            background: var(--gray-100);
        }

        .mode-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .batch-info {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 15px;
            border-radius: var(--radius-md);
            font-size: 0.95rem;
            margin-top: 15px;
            display: none;
        }

        .batch-info.show {
            display: block;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .container {
                padding: 15px;
            }
            
            .main-content {
                padding: 30px;
            }
            
            .nav-tab {
                min-width: 160px;
                padding: 12px 20px;
            }
        }

        @media (max-width: 992px) {
            .main-header h1 {
                font-size: 2.2rem;
            }
            
            .nav-tabs {
                flex-direction: column;
                gap: 8px;
            }
            
            .nav-tab {
                min-width: 100%;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .main-header {
                padding: 20px 15px;
            }
            
            .main-header h1 {
                font-size: 1.8rem;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .section-header h2 {
                font-size: 1.5rem;
            }
            
            .upload-area {
                padding: 30px 20px;
            }
            
            .btn-primary {
                width: 100%;
                justify-content: center;
                padding: 16px 20px;
            }
        }

        @media (max-width: 480px) {
            .main-header h1 {
                font-size: 1.6rem;
            }
            
            .nav-tab {
                padding: 10px 15px;
                font-size: 0.95rem;
            }
            
            .form-section {
                padding: 20px 15px;
            }
            
            .mode-switcher {
                flex-direction: column;
            }
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 25px;
            color: var(--gray-600);
            font-size: 0.95rem;
            background: white;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-md);
            margin-top: 30px;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
        }

        .footer-link {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
        }

        .footer-link:hover {
            color: var(--secondary);
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Main Header -->
        <header class="main-header">
            <h1>
                <i class="fas fa-file-pdf"></i> PDF Master Pro
                <span class="version-badge">v3.0</span>
            </h1>
            <p class="subtitle">Professional-grade PDF manipulation tools for merging, splitting, watermarking, and adding headers/footers</p>
        </header>

        <!-- Navigation Tabs -->
        <nav class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('merge')">
                <i class="fas fa-object-group"></i> Merge PDFs
            </button>
            <button class="nav-tab" onclick="switchTab('split')">
                <i class="fas fa-cut"></i> Split PDF
            </button>
            <button class="nav-tab" onclick="switchTab('watermark')">
                <i class="fas fa-water"></i> PDF Watermark
            </button>
            <button class="nav-tab" onclick="switchTab('imagewatermark')">
                <i class="fas fa-image"></i> Image Watermark
            </button>
            <button class="nav-tab" onclick="switchTab('headerfooter')">
                <i class="fas fa-heading"></i> Header & Footer
            </button>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Merge PDFs Tab -->
            <div id="merge" class="tab-pane active">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="fas fa-object-group"></i>
                    </div>
                    <h2>Merge Multiple PDF Files</h2>
                </div>
                
                <div class="upload-section">
                    <div class="upload-area" onclick="document.getElementById('mergeFiles').click()" 
                         ondrop="handleDrop(event, 'merge')" 
                         ondragover="handleDragOver(event)" 
                         ondragleave="handleDragLeave(event)">
                        <div class="upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <div class="upload-text">Drag & drop PDF files or click to browse</div>
                        <div class="upload-subtext">Select multiple PDF files to combine into a single document</div>
                        <div class="upload-badge">Multiple files allowed</div>
                    </div>
                    <input type="file" id="mergeFiles" accept=".pdf" multiple onchange="handleFileSelect(event, 'merge')">
                </div>
                
                <div class="file-list-container">
                    <div class="file-list-header">
                        <h4>Selected Files</h4>
                        <span class="file-count" id="mergeFileCount">0 files</span>
                    </div>
                    <div id="mergeFileList" class="file-list"></div>
                </div>
                
                <div class="progress-container" id="mergeProgress">
                    <div class="progress-header">
                        <span class="progress-label">Processing...</span>
                        <span class="progress-percent" id="mergeProgressPercent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="mergeProgressFill" style="width: 0%"></div>
                    </div>
                </div>
                
                <div class="btn-container">
                    <button class="btn-primary" onclick="mergePDFs()" id="mergeBtn" disabled>
                        <i class="fas fa-magic"></i> Merge & Download PDF
                    </button>
                </div>
                
                <div class="status-container">
                    <div id="mergeStatus" class="status-message"></div>
                </div>
            </div>

            <!-- Split PDF Tab -->
            <div id="split" class="tab-pane">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="fas fa-cut"></i>
                    </div>
                    <h2>Split PDF Document</h2>
                </div>
                
                <div class="upload-section">
                    <div class="upload-area" onclick="document.getElementById('splitFile').click()" 
                         ondrop="handleDrop(event, 'split')" 
                         ondragover="handleDragOver(event)" 
                         ondragleave="handleDragLeave(event)">
                        <div class="upload-icon">
                            <i class="fas fa-file-upload"></i>
                        </div>
                        <div class="upload-text">Drag & drop a PDF file or click to browse</div>
                        <div class="upload-subtext">Select a single PDF file to extract specific pages</div>
                        <div class="upload-badge">Single file</div>
                    </div>
                    <input type="file" id="splitFile" accept=".pdf" onchange="handleFileSelect(event, 'split')">
                </div>
                
                <div class="file-list-container">
                    <div class="file-list-header">
                        <h4>Selected File</h4>
                    </div>
                    <div id="splitFileList" class="file-list"></div>
                </div>
                
                <div class="form-section">
                    <div class="form-section-title">
                        <i class="fas fa-sliders-h"></i>
                        <h4>Page Range Settings</h4>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" for="startPage">
                                <i class="fas fa-play"></i> Start Page
                            </label>
                            <input type="number" id="startPage" class="form-control" min="1" placeholder="e.g., 1">
                            <small style="color: var(--gray-600); font-size: 0.85rem; display: block; margin-top: 5px;">First page to extract</small>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="endPage">
                                <i class="fas fa-stop"></i> End Page
                            </label>
                            <input type="number" id="endPage" class="form-control" min="1" placeholder="e.g., 10">
                            <small style="color: var(--gray-600); font-size: 0.85rem; display: block; margin-top: 5px;">Last page to extract (leave empty for all pages)</small>
                        </div>
                    </div>
                </div>
                
                <div class="btn-container">
                    <button class="btn-primary" onclick="splitPDF()" id="splitBtn" disabled>
                        <i class="fas fa-download"></i> Extract & Download
                    </button>
                </div>
                
                <div class="status-container">
                    <div id="splitStatus" class="status-message"></div>
                </div>
            </div>

            <!-- PDF Watermark Tab -->
            <div id="watermark" class="tab-pane">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="fas fa-water"></i>
                    </div>
                    <h2>Add Watermark to PDF</h2>
                </div>
                
                <div class="upload-section">
                    <div class="upload-area" onclick="document.getElementById('watermarkFile').click()" 
                         ondrop="handleDrop(event, 'watermark')" 
                         ondragover="handleDragOver(event)" 
                         ondragleave="handleDragLeave(event)">
                        <div class="upload-icon">
                            <i class="fas fa-file-signature"></i>
                        </div>
                        <div class="upload-text">Drag & drop a PDF file or click to browse</div>
                        <div class="upload-subtext">Select PDF file to add watermark</div>
                    </div>
                    <input type="file" id="watermarkFile" accept=".pdf" onchange="handleFileSelect(event, 'watermark')">
                </div>
                
                <div class="file-list-container">
                    <div class="file-list-header">
                        <h4>Selected File</h4>
                    </div>
                    <div id="watermarkFileList" class="file-list"></div>
                </div>
                
                <div class="form-section">
                    <div class="form-section-title">
                        <i class="fas fa-cog"></i>
                        <h4>Watermark Settings</h4>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-tag"></i> Watermark Type
                        </label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="watermarkType" value="text" checked onchange="toggleWatermarkType()">
                                <span>Text Watermark</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="watermarkType" value="image" onchange="toggleWatermarkType()">
                                <span>Image Watermark</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Text Watermark Options -->
                    <div id="textWatermarkOptions">
                        <div class="form-group">
                            <label class="form-label" for="watermarkText">
                                <i class="fas fa-font"></i> Watermark Text
                            </label>
                            <input type="text" id="watermarkText" class="form-control" placeholder="Enter watermark text" oninput="updateWatermarkPreview()">
                        </div>
                        
                        <div class="preview-container">
                            <div class="preview-label">
                                <i class="fas fa-eye"></i> Preview
                            </div>
                            <div class="preview-box">
                                <canvas id="watermarkPreview" width="300" height="200"></canvas>
                            </div>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label" for="watermarkColor">
                                    <i class="fas fa-palette"></i> Text Color
                                </label>
                                <div class="color-picker-container">
                                    <input type="color" id="watermarkColor" value="#ff0000" onchange="updateWatermarkPreview()">
                                    <span style="color: var(--gray-600); font-size: 0.9rem;">Click to pick color</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-adjust"></i> Transparency
                                </label>
                                <div class="range-group">
                                    <div class="range-label">
                                        <span>Opacity</span>
                                        <span class="range-value" id="opacityValue">30%</span>
                                    </div>
                                    <input type="range" id="watermarkOpacity" min="0" max="100" value="30" oninput="document.getElementById('opacityValue').textContent = this.value + '%'; updateWatermarkPreview()">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-text-height"></i> Text Size
                                </label>
                                <div class="range-group">
                                    <div class="range-label">
                                        <span>Size</span>
                                        <span class="range-value" id="sizeValue">50</span>
                                    </div>
                                    <input type="range" id="watermarkSize" min="20" max="100" value="50" oninput="document.getElementById('sizeValue').textContent = this.value; updateWatermarkPreview()">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Image Watermark Options -->
                    <div id="imageWatermarkOptions" style="display: none;">
                        <div class="upload-area" onclick="document.getElementById('watermarkImageFile').click()" style="margin-bottom: 20px;">
                            <div class="upload-icon">
                                <i class="fas fa-image"></i>
                            </div>
                            <div class="upload-text">Click to upload watermark image</div>
                            <div class="upload-subtext">PNG, JPG, or JPEG format (transparent PNG recommended)</div>
                        </div>
                        <input type="file" id="watermarkImageFile" accept="image/png,image/jpeg,image/jpg" onchange="handleWatermarkImageSelect(event)">
                        
                        <div id="watermarkImagePreviewContainer" style="display: none;">
                            <div class="preview-container">
                                <div class="preview-label">
                                    <i class="fas fa-image"></i> Selected Image
                                </div>
                                <div class="preview-box">
                                    <img id="watermarkImagePreview" style="max-width: 100%; max-height: 180px; border-radius: var(--radius-sm);">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-adjust"></i> Transparency
                                </label>
                                <div class="range-group">
                                    <div class="range-label">
                                        <span>Opacity</span>
                                        <span class="range-value" id="imageOpacityValue">30%</span>
                                    </div>
                                    <input type="range" id="imageOpacity" min="0" max="100" value="30" oninput="document.getElementById('imageOpacityValue').textContent = this.value + '%'">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-expand-alt"></i> Image Scale
                                </label>
                                <div class="range-group">
                                    <div class="range-label">
                                        <span>Scale</span>
                                        <span class="range-value" id="imageScaleValue">50%</span>
                                    </div>
                                    <input type="range" id="imageScale" min="10" max="100" value="50" oninput="document.getElementById('imageScaleValue').textContent = this.value + '%'">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="btn-container">
                    <button class="btn-primary" onclick="addWatermark()" id="watermarkBtn" disabled>
                        <i class="fas fa-stamp"></i> Apply Watermark & Download
                    </button>
                </div>
                
                <div class="status-container">
                    <div id="watermarkStatus" class="status-message"></div>
                </div>
            </div>

            <!-- Image Watermark Tab -->
            <div id="imagewatermark" class="tab-pane">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="fas fa-image"></i>
                    </div>
                    <h2>Add Watermark to Images</h2>
                </div>
                
                <div class="upload-section">
                    <div class="upload-area" onclick="document.getElementById('imageWatermarkSourceFile').click()" 
                         ondrop="handleDrop(event, 'imagewatermark')" 
                         ondragover="handleDragOver(event)" 
                         ondragleave="handleDragLeave(event)">
                        <div class="upload-icon">
                            <i class="fas fa-file-image"></i>
                        </div>
                        <div class="upload-text">Drag & drop an image or click to browse</div>
                        <div class="upload-subtext">PNG, JPG, or JPEG format</div>
                    </div>
                    <input type="file" id="imageWatermarkSourceFile" accept="image/png,image/jpeg,image/jpg" onchange="handleFileSelect(event, 'imagewatermark')">
                </div>
                
                <div class="file-list-container">
                    <div class="file-list-header">
                        <h4>Selected Image</h4>
                    </div>
                    <div id="imagewatermarkFileList" class="file-list"></div>
                </div>
                
                <div class="form-section">
                    <div class="form-section-title">
                        <i class="fas fa-cog"></i>
                        <h4>Watermark Settings</h4>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-tag"></i> Watermark Type
                        </label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="imgWatermarkType" value="text" checked onchange="toggleImageWatermarkType()">
                                <span>Text Watermark</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="imgWatermarkType" value="image" onchange="toggleImageWatermarkType()">
                                <span>Image Watermark</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Text Watermark Options -->
                    <div id="imgTextWatermarkOptions">
                        <div class="form-group">
                            <label class="form-label" for="imgWatermarkText">
                                <i class="fas fa-font"></i> Watermark Text
                            </label>
                            <input type="text" id="imgWatermarkText" class="form-control" placeholder="Enter watermark text" oninput="updateImageWatermarkPreview()">
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label" for="imgWatermarkColor">
                                    <i class="fas fa-palette"></i> Text Color
                                </label>
                                <input type="color" id="imgWatermarkColor" value="#ffffff" onchange="updateImageWatermarkPreview()">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-adjust"></i> Transparency
                                </label>
                                <div class="range-group">
                                    <div class="range-label">
                                        <span>Opacity</span>
                                        <span class="range-value" id="imgOpacityValue">70%</span>
                                    </div>
                                    <input type="range" id="imgWatermarkOpacity" min="0" max="100" value="70" oninput="document.getElementById('imgOpacityValue').textContent = this.value + '%'; updateImageWatermarkPreview()">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-text-height"></i> Text Size
                                </label>
                                <div class="range-group">
                                    <div class="range-label">
                                        <span>Size</span>
                                        <span class="range-value" id="imgSizeValue">50</span>
                                    </div>
                                    <input type="range" id="imgWatermarkSize" min="20" max="150" value="50" oninput="document.getElementById('imgSizeValue').textContent = this.value; updateImageWatermarkPreview()">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="imgWatermarkPosition">
                                    <i class="fas fa-crosshairs"></i> Position
                                </label>
                                <select id="imgWatermarkPosition" class="form-control" onchange="updateImageWatermarkPreview()">
                                    <option value="center">Center</option>
                                    <option value="center-diagonal">Center Diagonal</option>
                                    <option value="top-left">Top Left</option>
                                    <option value="top-right">Top Right</option>
                                    <option value="bottom-left">Bottom Left</option>
                                    <option value="bottom-right">Bottom Right</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Image Watermark Options -->
                    <div id="imgImageWatermarkOptions" style="display: none;">
                        <div class="upload-area" onclick="document.getElementById('imgWatermarkLogoFile').click()" style="margin-bottom: 20px;">
                            <div class="upload-icon">
                                <i class="fas fa-image"></i>
                            </div>
                            <div class="upload-text">Click to upload watermark logo</div>
                            <div class="upload-subtext">PNG recommended for transparency</div>
                        </div>
                        <input type="file" id="imgWatermarkLogoFile" accept="image/png,image/jpeg,image/jpg" onchange="handleImgWatermarkLogoSelect(event)">
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-adjust"></i> Transparency
                                </label>
                                <div class="range-group">
                                    <div class="range-label">
                                        <span>Opacity</span>
                                        <span class="range-value" id="imgLogoOpacityValue">70%</span>
                                    </div>
                                    <input type="range" id="imgLogoOpacity" min="0" max="100" value="70" oninput="document.getElementById('imgLogoOpacityValue').textContent = this.value + '%'; updateImageWatermarkPreview()">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-expand-alt"></i> Logo Scale
                                </label>
                                <div class="range-group">
                                    <div class="range-label">
                                        <span>Scale</span>
                                        <span class="range-value" id="imgLogoScaleValue">30%</span>
                                    </div>
                                    <input type="range" id="imgLogoScale" min="5" max="100" value="30" oninput="document.getElementById('imgLogoScaleValue').textContent = this.value + '%'; updateImageWatermarkPreview()">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="imgLogoPosition">
                                    <i class="fas fa-crosshairs"></i> Position
                                </label>
                                <select id="imgLogoPosition" class="form-control" onchange="updateImageWatermarkPreview()">
                                    <option value="center">Center</option>
                                    <option value="center-diagonal">Center Diagonal</option>
                                    <option value="top-left">Top Left</option>
                                    <option value="top-right">Top Right</option>
                                    <option value="bottom-left">Bottom Left</option>
                                    <option value="bottom-right">Bottom Right</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="preview-container">
                    <div class="preview-label">
                        <i class="fas fa-eye"></i> Live Preview
                    </div>
                    <div class="preview-box">
                        <canvas id="imgWatermarkPreview" width="400" height="300" style="max-width: 100%; border-radius: var(--radius-sm);"></canvas>
                    </div>
                </div>
                
                <div class="btn-container">
                    <button class="btn-primary" onclick="processImageWatermark()" id="imgWatermarkBtn" disabled>
                        <i class="fas fa-water"></i> Apply to Image & Download
                    </button>
                </div>
                
                <div class="status-container">
                    <div id="imagewatermarkStatus" class="status-message"></div>
                </div>
            </div>

            <!-- Header & Footer Tab -->
            <div id="headerfooter" class="tab-pane">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="fas fa-heading"></i>
                    </div>
                    <h2>Add Headers & Footers to PDF</h2>
                </div>
                
                <!-- Batch Processing Section -->
                <div class="batch-section">
                    <div class="batch-header">
                        <i class="fas fa-layer-group"></i>
                        <h4>Processing Mode</h4>
                        <span class="batch-badge">BATCH</span>
                    </div>
                    
                    <p style="color: var(--gray-700); margin-bottom: 15px;">
                        Choose between single file processing or batch processing multiple files at once.
                    </p>
                    
                    <div class="mode-switcher">
                        <button class="mode-btn active" onclick="setProcessingMode('single')">
                            <i class="fas fa-file-pdf"></i> Single File
                        </button>
                        <button class="mode-btn" onclick="setProcessingMode('batch')">
                            <i class="fas fa-folder"></i> Multiple Files
                        </button>
                    </div>
                    
                    <div class="batch-info" id="batchInfo">
                        <i class="fas fa-info-circle"></i> Batch mode will process all uploaded PDFs and download them as a ZIP file.
                    </div>
                </div>
                
                <!-- Upload Section -->
                <div class="upload-section" id="singleUploadSection">
                    <div class="upload-area" onclick="document.getElementById('headerFooterFile').click()" 
                         ondrop="handleDrop(event, 'headerfooter')" 
                         ondragover="handleDragOver(event)" 
                         ondragleave="handleDragLeave(event)">
                        <div class="upload-icon">
                            <i class="fas fa-file-import"></i>
                        </div>
                        <div class="upload-text">Drag & drop a PDF file or click to browse</div>
                        <div class="upload-subtext">Select a single PDF file to add headers and footers</div>
                    </div>
                    <input type="file" id="headerFooterFile" accept=".pdf" onchange="handleFileSelect(event, 'headerfooter')">
                </div>
                
                <div class="upload-section" id="batchUploadSection" style="display: none;">
                    <div class="upload-area" onclick="document.getElementById('headerFooterFiles').click()" 
                         ondrop="handleDropBatch(event, 'headerfooter')" 
                         ondragover="handleDragOver(event)" 
                         ondragleave="handleDragLeave(event)">
                        <div class="upload-icon">
                            <i class="fas fa-folder-open"></i>
                        </div>
                        <div class="upload-text">Drag & drop multiple PDF files or click to browse</div>
                        <div class="upload-subtext">Select multiple PDF files for batch processing</div>
                        <div class="upload-badge">Multiple files</div>
                    </div>
                    <input type="file" id="headerFooterFiles" accept=".pdf" multiple style="display: none;" onchange="handleBatchFileSelect(event, 'headerfooter')">
                </div>
                
                <div class="file-list-container">
                    <div class="file-list-header">
                        <h4>Selected Files</h4>
                        <span class="file-count" id="headerFooterFileCount">0 files</span>
                    </div>
                    <div id="headerfooterFileList" class="file-list"></div>
                </div>
                
                <!-- Header Settings -->
                <div class="form-section">
                    <div class="form-section-title">
                        <i class="fas fa-heading"></i>
                        <h4>Header Settings</h4>
                    </div>
                    
                    <div class="form-group">
                        <label class="checkbox-option">
                            <input type="checkbox" id="enableHeader" onchange="toggleHeaderFooter('header')">
                            <span style="font-weight: 500;">Enable Header</span>
                        </label>
                    </div>
                    
                    <div id="headerOptions" style="display: none;">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label" for="headerText">
                                    <i class="fas fa-font"></i> Header Text
                                </label>
                                <input type="text" id="headerText" class="form-control" placeholder="Enter header text">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="headerLink">
                                    <i class="fas fa-link"></i> Link (Optional)
                                </label>
                                <input type="text" id="headerLink" class="form-control" placeholder="https://example.com">
                                <small style="color: var(--gray-600); font-size: 0.85rem; display: block; margin-top: 5px;">Make header clickable by adding a URL</small>
                            </div>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label" for="headerColor">
                                    <i class="fas fa-palette"></i> Text Color
                                </label>
                                <input type="color" id="headerColor" value="#000000" class="form-control" style="padding: 5px; height: 50px;">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-text-height"></i> Font Size
                                </label>
                                <div class="range-group">
                                    <div class="range-label">
                                        <span>Size</span>
                                        <span class="range-value" id="headerSizeValue">12</span>
                                    </div>
                                    <input type="range" id="headerSize" min="8" max="24" value="12" oninput="document.getElementById('headerSizeValue').textContent = this.value">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="headerAlignment">
                                    <i class="fas fa-align-center"></i> Alignment
                                </label>
                                <select id="headerAlignment" class="form-control">
                                    <option value="left">Left</option>
                                    <option value="center" selected>Center</option>
                                    <option value="right">Right</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Footer Settings -->
                <div class="form-section">
                    <div class="form-section-title">
                        <i class="fas fa-shoe-prints"></i>
                        <h4>Footer Settings</h4>
                    </div>
                    
                    <div class="form-group">
                        <label class="checkbox-option">
                            <input type="checkbox" id="enableFooter" onchange="toggleHeaderFooter('footer')">
                            <span style="font-weight: 500;">Enable Footer</span>
                        </label>
                    </div>
                    
                    <div id="footerOptions" style="display: none;">
                        <div class="form-group">
                            <label class="form-label" for="footerText">
                                <i class="fas fa-font"></i> Footer Text
                            </label>
                            <input type="text" id="footerText" class="form-control" placeholder="Enter footer text or use {page} for page number">
                            <small style="color: var(--gray-600); font-size: 0.85rem; display: block; margin-top: 5px;">
                                Use <code>{page}</code> to show page numbers (e.g., "Page {page} of {total}")
                            </small>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label" for="footerColor">
                                    <i class="fas fa-palette"></i> Text Color
                                </label>
                                <input type="color" id="footerColor" value="#666666" class="form-control" style="padding: 5px; height: 50px;">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-text-height"></i> Font Size
                                </label>
                                <div class="range-group">
                                    <div class="range-label">
                                        <span>Size</span>
                                        <span class="range-value" id="footerSizeValue">10</span>
                                    </div>
                                    <input type="range" id="footerSize" min="8" max="24" value="10" oninput="document.getElementById('footerSizeValue').textContent = this.value">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="footerAlignment">
                                    <i class="fas fa-align-center"></i> Alignment
                                </label>
                                <select id="footerAlignment" class="form-control">
                                    <option value="left">Left</option>
                                    <option value="center" selected>Center</option>
                                    <option value="right">Right</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="progress-container" id="headerfooterProgress">
                    <div class="progress-header">
                        <span class="progress-label">Processing...</span>
                        <span class="progress-percent" id="headerfooterProgressPercent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="headerfooterProgressFill" style="width: 0%"></div>
                    </div>
                </div>
                
                <div class="btn-container">
                    <button class="btn-primary" onclick="addHeaderFooter()" id="headerFooterBtn" disabled>
                        <i class="fas fa-file-export"></i> Process & Download
                    </button>
                </div>
                
                <div class="status-container">
                    <div id="headerfooterStatus" class="status-message"></div>
                </div>
            </div>
        </main>
        
        <!-- Footer -->
        <footer class="footer">
            <p> 2023 PDF Master Pro | Professional PDF Manipulation Tool</p>
            <div class="footer-links">
                <a href="#" class="footer-link">Privacy Policy</a>
                <a href="#" class="footer-link">Terms of Service</a>
                <a href="#" class="footer-link">Support</a>
                <a href="#" class="footer-link">Documentation</a>
            </div>
        </footer>
    </div>

    <script>
        // Global variables to store files
        let mergeFiles = [];
        let splitFile = null;
        let watermarkFile = null;
        let watermarkImageFile = null;
        let watermarkImageData = null;
        let imageWatermarkSourceFile = null;
        let imageWatermarkSourceData = null;
        let imgWatermarkLogoFile = null;
        let imgWatermarkLogoData = null;
        let headerFooterFiles = [];
        let processingMode = 'single';

        // Initialize PDFLib
        const { PDFDocument, rgb, degrees } = PDFLib;

        // Tab switching
        function switchTab(tabName) {
            // Update active tab
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
            
            // Set active tab and pane
            document.querySelectorAll('.nav-tab').forEach(tab => {
                if (tab.getAttribute('onclick')?.includes(tabName)) {
                    tab.classList.add('active');
                }
            });
            document.getElementById(tabName).classList.add('active');
            
            // Clear status messages
            document.querySelectorAll('.status-message').forEach(s => {
                s.classList.remove('show');
                s.className = 'status-message';
            });
        }

        // Drag and drop handlers
        function handleDragOver(e) {
            e.preventDefault();
            e.stopPropagation();
            e.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            e.stopPropagation();
            e.currentTarget.classList.remove('dragover');
        }

        function handleDrop(e, type) {
            e.preventDefault();
            e.stopPropagation();
            e.currentTarget.classList.remove('dragover');
            
            const files = Array.from(e.dataTransfer.files);
            
            if (type === 'imagewatermark') {
                const imageFiles = files.filter(f => f.type.startsWith('image/'));
                if (imageFiles.length === 0) {
                    showStatus(type, ' Please upload image files only', true);
                    return;
                }
                imageWatermarkSourceFile = imageFiles[0];
                loadImageWatermarkSource();
                displayFiles(type);
                return;
            }
            
            const pdfFiles = files.filter(f => f.type === 'application/pdf');
            
            if (pdfFiles.length === 0) {
                showStatus(type, ' Please upload PDF files only', true);
                return;
            }
            
            if (type === 'merge') {
                mergeFiles = mergeFiles.concat(pdfFiles);
                displayFiles(type);
            } else if (type === 'split') {
                splitFile = pdfFiles[0];
                displayFiles(type);
            } else if (type === 'watermark') {
                watermarkFile = pdfFiles[0];
                displayFiles(type);
            } else if (type === 'headerfooter') {
                if (processingMode === 'single') {
                    headerFooterFiles = [pdfFiles[0]];
                } else {
                    headerFooterFiles = headerFooterFiles.concat(pdfFiles);
                }
                displayFiles(type);
            }
        }

        function handleDropBatch(e, type) {
            e.preventDefault();
            e.stopPropagation();
            e.currentTarget.classList.remove('dragover');
            
            if (type === 'headerfooter') {
                const files = Array.from(e.dataTransfer.files).filter(f => f.type === 'application/pdf');
                
                if (files.length === 0) {
                    showStatus('headerfooter', ' Please upload PDF files only', true);
                    return;
                }
                
                headerFooterFiles = headerFooterFiles.concat(files);
                displayFiles(type);
            }
        }

        // File selection handlers
        function handleFileSelect(e, type) {
            const files = Array.from(e.target.files);
            
            if (type === 'merge') {
                mergeFiles = mergeFiles.concat(files);
                displayFiles(type);
            } else if (type === 'split') {
                splitFile = files[0];
                displayFiles(type);
            } else if (type === 'watermark') {
                watermarkFile = files[0];
                displayFiles(type);
            } else if (type === 'imagewatermark') {
                imageWatermarkSourceFile = files[0];
                loadImageWatermarkSource();
                displayFiles(type);
            } else if (type === 'headerfooter') {
                if (processingMode === 'single') {
                    headerFooterFiles = [files[0]];
                } else {
                    headerFooterFiles = headerFooterFiles.concat(files);
                }
                displayFiles(type);
            }
        }

        function handleBatchFileSelect(e, type) {
            const files = Array.from(e.target.files);
            if (type === 'headerfooter') {
                headerFooterFiles = headerFooterFiles.concat(files);
                displayFiles(type);
            }
        }

        // Display files in lists
        function displayFiles(type) {
            const listId = type + 'FileList';
            const countId = type === 'headerfooter' ? 'headerFooterFileCount' : 
                          type === 'merge' ? 'mergeFileCount' : null;
            const list = document.getElementById(listId);
            
            if (!list) return;
            
            if (type === 'merge') {
                list.innerHTML = mergeFiles.map((file, idx) => `
                    <div class="file-item">
                        <div class="file-info">
                            <i class="fas fa-file-pdf file-icon"></i>
                            <div>
                                <div class="file-name">${file.name}</div>
                                <div class="file-size">${formatFileSize(file.size)}</div>
                            </div>
                        </div>
                        <div class="file-actions">
                            <button class="btn-remove" onclick="removeFile(${idx}, 'merge')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
                
                const btn = document.getElementById('mergeBtn');
                if (btn) btn.disabled = mergeFiles.length < 2;
                
                if (countId) {
                    document.getElementById(countId).textContent = `${mergeFiles.length} files`;
                }
            } 
            else if (type === 'split') {
                const file = splitFile;
                list.innerHTML = file ? `
                    <div class="file-item">
                        <div class="file-info">
                            <i class="fas fa-file-pdf file-icon"></i>
                            <div>
                                <div class="file-name">${file.name}</div>
                                <div class="file-size">${formatFileSize(file.size)}</div>
                            </div>
                        </div>
                        <div class="file-actions">
                            <button class="btn-remove" onclick="removeFile(0, 'split')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                ` : '';
                
                const btn = document.getElementById('splitBtn');
                if (btn) btn.disabled = !file;
            }
            else if (type === 'watermark') {
                const file = watermarkFile;
                list.innerHTML = file ? `
                    <div class="file-item">
                        <div class="file-info">
                            <i class="fas fa-file-pdf file-icon"></i>
                            <div>
                                <div class="file-name">${file.name}</div>
                                <div class="file-size">${formatFileSize(file.size)}</div>
                            </div>
                        </div>
                        <div class="file-actions">
                            <button class="btn-remove" onclick="removeFile(0, 'watermark')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                ` : '';
                
                updateWatermarkButton();
            }
            else if (type === 'imagewatermark') {
                const file = imageWatermarkSourceFile;
                list.innerHTML = file ? `
                    <div class="file-item">
                        <div class="file-info">
                            <i class="fas fa-image file-icon"></i>
                            <div>
                                <div class="file-name">${file.name}</div>
                                <div class="file-size">${formatFileSize(file.size)}</div>
                            </div>
                        </div>
                        <div class="file-actions">
                            <button class="btn-remove" onclick="removeFile(0, 'imagewatermark')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                ` : '';
                
                const btn = document.getElementById('imgWatermarkBtn');
                if (btn) btn.disabled = !file;
            }
            else if (type === 'headerfooter') {
                list.innerHTML = headerFooterFiles.map((file, idx) => `
                    <div class="file-item">
                        <div class="file-info">
                            <i class="fas fa-file-pdf file-icon"></i>
                            <div>
                                <div class="file-name">${file.name}</div>
                                <div class="file-size">${formatFileSize(file.size)}</div>
                            </div>
                        </div>
                        <div class="file-actions">
                            <button class="btn-remove" onclick="removeFile(${idx}, 'headerfooter')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
                
                const btn = document.getElementById('headerFooterBtn');
                if (btn) {
                    if (processingMode === 'single') {
                        btn.disabled = headerFooterFiles.length === 0;
                        btn.innerHTML = '<i class="fas fa-file-export"></i> Process & Download';
                    } else {
                        btn.disabled = headerFooterFiles.length === 0;
                        btn.innerHTML = `<i class="fas fa-file-export"></i> Process ${headerFooterFiles.length} PDF(s) & Download ZIP`;
                    }
                }
                
                if (countId) {
                    document.getElementById(countId).textContent = `${headerFooterFiles.length} files`;
                }
            }
        }

        // Remove file from list
        function removeFile(idx, type) {
            if (type === 'merge') {
                mergeFiles.splice(idx, 1);
            } else if (type === 'split') {
                splitFile = null;
            } else if (type === 'watermark') {
                watermarkFile = null;
            } else if (type === 'imagewatermark') {
                imageWatermarkSourceFile = null;
                imageWatermarkSourceData = null;
            } else if (type === 'headerfooter') {
                headerFooterFiles.splice(idx, 1);
            }
            displayFiles(type);
        }

        // Format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Show status message
        function showStatus(type, message, isError = false) {
            const statusId = type === 'imagewatermark' ? 'imagewatermarkStatus' : 
                           type === 'headerfooter' ? 'headerfooterStatus' : 
                           type + 'Status';
            
            const status = document.getElementById(statusId);
            if (!status) return;
            
            status.innerHTML = `
                <i class="fas ${isError ? 'fa-exclamation-circle status-icon' : 'fa-check-circle status-icon'}"></i>
                <span>${message}</span>
            `;
            status.className = `status-message ${isError ? 'status-error' : 'status-success'} show`;
            
            // Auto hide after 5 seconds
            setTimeout(() => {
                status.classList.remove('show');
            }, 5000);
        }

        // Update progress bar
        function updateProgress(type, percent) {
            const progress = document.getElementById(type + 'Progress');
            const percentEl = document.getElementById(type + 'ProgressPercent');
            const fillEl = document.getElementById(type + 'ProgressFill');
            
            if (progress && percentEl && fillEl) {
                progress.style.display = 'block';
                percentEl.textContent = Math.round(percent) + '%';
                fillEl.style.width = percent + '%';
            }
        }

        // Hide progress bar
        function hideProgress(type) {
            const progress = document.getElementById(type + 'Progress');
            if (progress) {
                progress.style.display = 'none';
            }
        }

        // Merge PDFs function
        async function mergePDFs() {
            const btn = document.getElementById('mergeBtn');
            if (!btn) return;
            
            btn.disabled = true;
            
            try {
                showStatus('merge', ' Starting merge process...', false);
                updateProgress('merge', 10);
                
                const mergedPdf = await PDFDocument.create();
                updateProgress('merge', 20);
                
                for (let i = 0; i < mergeFiles.length; i++) {
                    const file = mergeFiles[i];
                    showStatus('merge', ` Processing file ${i + 1} of ${mergeFiles.length}...`, false);
                    
                    const fileData = await file.arrayBuffer();
                    updateProgress('merge', 20 + (i / mergeFiles.length) * 60);
                    
                    try {
                        const pdf = await PDFDocument.load(fileData, {
                            ignoreEncryption: true,
                            updateMetadata: false
                        });
                        
                        const pageCount = pdf.getPageCount();
                        const pageIndices = Array.from({ length: pageCount }, (_, i) => i);
                        const copiedPages = await mergedPdf.copyPages(pdf, pageIndices);
                        
                        copiedPages.forEach((page) => {
                            mergedPdf.addPage(page);
                        });
                    } catch (error) {
                        console.error(`Error processing ${file.name}:`, error);
                        showStatus('merge', ` Warning: Could not process ${file.name}. Skipping...`, false);
                    }
                }
                
                updateProgress('merge', 90);
                showStatus('merge', ' Generating final PDF...', false);
                
                const mergedPdfBytes = await mergedPdf.save();
                updateProgress('merge', 100);
                
                // Download
                const blob = new Blob([mergedPdfBytes], { type: 'application/pdf' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'merged-document.pdf';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                hideProgress('merge');
                showStatus('merge', ' PDFs merged successfully! Download started.', false);
                
            } catch (error) {
                console.error('Merge error:', error);
                hideProgress('merge');
                showStatus('merge', ' Error: ' + error.message + '. Please try with different PDF files.', true);
            } finally {
                btn.disabled = false;
            }
        }

        // Split PDF function
        async function splitPDF() {
            const btn = document.getElementById('splitBtn');
            if (!btn) return;
            
            btn.disabled = true;
            
            try {
                const startPage = parseInt(document.getElementById('startPage').value) || 1;
                if (!splitFile) {
                    showStatus('split', ' Please upload a PDF file first', true);
                    btn.disabled = false;
                    return;
                }
                
                const fileData = await splitFile.arrayBuffer();
                
                showStatus('split', ' Loading PDF...', false);
                const pdf = await PDFDocument.load(fileData, {
                    ignoreEncryption: true,
                    updateMetadata: false
                });
                
                const totalPages = pdf.getPageCount();
                const endPageInput = document.getElementById('endPage').value;
                const endPage = endPageInput ? parseInt(endPageInput) : totalPages;

                if (startPage < 1 || endPage > totalPages || startPage > endPage) {
                    showStatus('split', ` Invalid page range! PDF has ${totalPages} pages.`, true);
                    btn.disabled = false;
                    return;
                }

                showStatus('split', ' Splitting PDF...', false);
                const newPdf = await PDFDocument.create();
                
                const pagesToCopy = Array.from(
                    { length: endPage - startPage + 1 }, 
                    (_, i) => startPage - 1 + i
                );
                const copiedPages = await newPdf.copyPages(pdf, pagesToCopy);
                copiedPages.forEach(page => newPdf.addPage(page));

                const pdfBytes = await newPdf.save();
                
                // Download
                const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `split-pages-${startPage}-to-${endPage}.pdf`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                showStatus('split', ` PDF split successfully! Pages ${startPage}-${endPage} extracted.`, false);
                
            } catch (error) {
                console.error('Split error:', error);
                showStatus('split', ' Error: ' + error.message, true);
            } finally {
                btn.disabled = false;
            }
        }

        // Watermark functions
        function toggleWatermarkType() {
            const type = document.querySelector('input[name="watermarkType"]:checked').value;
            const textOptions = document.getElementById('textWatermarkOptions');
            const imageOptions = document.getElementById('imageWatermarkOptions');
            
            if (type === 'text') {
                textOptions.style.display = 'block';
                imageOptions.style.display = 'none';
            } else {
                textOptions.style.display = 'none';
                imageOptions.style.display = 'block';
            }
            
            updateWatermarkButton();
        }

        function handleWatermarkImageSelect(e) {
            const file = e.target.files[0];
            if (file) {
                watermarkImageFile = file;
                const reader = new FileReader();
                reader.onload = function(event) {
                    watermarkImageData = event.target.result;
                    const preview = document.getElementById('watermarkImagePreview');
                    preview.src = watermarkImageData;
                    document.getElementById('watermarkImagePreviewContainer').style.display = 'block';
                    updateWatermarkButton();
                };
                reader.readAsDataURL(file);
            }
        }

        function updateWatermarkButton() {
            const type = document.querySelector('input[name="watermarkType"]:checked').value;
            const btn = document.getElementById('watermarkBtn');
            
            if (type === 'text') {
                btn.disabled = !watermarkFile;
            } else {
                btn.disabled = !watermarkFile || !watermarkImageFile;
            }
        }

        function updateWatermarkPreview() {
            const canvas = document.getElementById('watermarkPreview');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const text = document.getElementById('watermarkText').value || 'SAMPLE';
            const color = document.getElementById('watermarkColor').value;
            const transparencyPercent = parseFloat(document.getElementById('watermarkOpacity').value) || 30;
            const fontSize = parseInt(document.getElementById('watermarkSize').value) || 50;
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Fill background
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Set up watermark text
            ctx.save();
            ctx.translate(canvas.width / 2, canvas.height / 2);
            ctx.rotate(45 * Math.PI / 180);
            
            // Calculate scaled font size for preview
            const previewFontSize = fontSize * 0.6;
            ctx.font = `bold ${previewFontSize}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            // Set color and transparency
            const opacity = transparencyPercent / 100;
            ctx.globalAlpha = opacity;
            ctx.fillStyle = color;
            
            // Draw text
            ctx.fillText(text, 0, 0);
            ctx.restore();
        }

        async function addWatermark() {
            const btn = document.getElementById('watermarkBtn');
            btn.disabled = true;
            
            const type = document.querySelector('input[name="watermarkType"]:checked').value;
            
            try {
                showStatus('watermark', ' Loading PDF...', false);
                const fileData = await watermarkFile.arrayBuffer();
                const pdfDoc = await PDFDocument.load(fileData, {
                    ignoreEncryption: true,
                    updateMetadata: false
                });
                
                const pages = pdfDoc.getPages();
                
                if (type === 'text') {
                    await addTextWatermark(pdfDoc, pages);
                } else {
                    await addImageWatermark(pdfDoc, pages);
                }

                const pdfBytes = await pdfDoc.save();
                
                // Download
                const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'watermarked-document.pdf';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                showStatus('watermark', ' Watermark added successfully!', false);
                
            } catch (error) {
                console.error('Watermark error:', error);
                showStatus('watermark', ' Error: ' + error.message, true);
            } finally {
                btn.disabled = false;
            }
        }

        async function addTextWatermark(pdfDoc, pages) {
            const text = document.getElementById('watermarkText').value.trim();
            if (!text) {
                throw new Error('Please enter watermark text!');
            }
            
            const helveticaFont = await pdfDoc.embedFont('Helvetica-Bold');
            
            const color = document.getElementById('watermarkColor').value;
            const r = parseInt(color.substr(1, 2), 16) / 255;
            const g = parseInt(color.substr(3, 2), 16) / 255;
            const b = parseInt(color.substr(5, 2), 16) / 255;
            
            const transparencyPercent = parseFloat(document.getElementById('watermarkOpacity').value) || 30;
            const opacity = transparencyPercent / 100;
            const fontSize = parseInt(document.getElementById('watermarkSize').value) || 50;

            showStatus('watermark', ' Adding text watermark to pages...', false);
            
            pages.forEach((page) => {
                const { width, height } = page.getSize();
                
                const textWidth = helveticaFont.widthOfTextAtSize(text, fontSize);
                const textHeight = helveticaFont.heightAtSize(fontSize);
                
                const angle = 45;
                const radians = (angle * Math.PI) / 180;
                
                const centerX = width / 2;
                const centerY = height / 2;
                
                const offsetX = -(textWidth / 2) * Math.cos(radians) + (textHeight / 2) * Math.sin(radians);
                const offsetY = -(textWidth / 2) * Math.sin(radians) - (textHeight / 2) * Math.cos(radians);
                
                page.drawText(text, {
                    x: centerX + offsetX,
                    y: centerY + offsetY,
                    size: fontSize,
                    font: helveticaFont,
                    color: rgb(r, g, b),
                    opacity: opacity,
                    rotate: degrees(angle)
                });
            });
        }

        async function addImageWatermark(pdfDoc, pages) {
            if (!watermarkImageData) {
                throw new Error('Please select a watermark image!');
            }
            
            showStatus('watermark', ' Embedding image...', false);
            
            let image;
            if (watermarkImageFile.type === 'image/png') {
                image = await pdfDoc.embedPng(watermarkImageData);
            } else {
                image = await pdfDoc.embedJpg(watermarkImageData);
            }
            
            const transparencyPercent = parseFloat(document.getElementById('imageOpacity').value) || 30;
            const opacity = transparencyPercent / 100;
            
            const scalePercent = parseFloat(document.getElementById('imageScale').value) || 50;
            const scale = scalePercent / 100;
            
            showStatus('watermark', ' Adding image watermark to pages...', false);
            
            pages.forEach((page) => {
                const { width, height } = page.getSize();
                
                const imgWidth = image.width * scale;
                const imgHeight = image.height * scale;
                
                const x = (width - imgWidth) / 2;
                const y = (height - imgHeight) / 2;
                
                page.drawImage(image, {
                    x: x,
                    y: y,
                    width: imgWidth,
                    height: imgHeight,
                    opacity: opacity,
                    rotate: degrees(0)
                });
            });
        }

        // Image watermark functions
        function loadImageWatermarkSource() {
            if (!imageWatermarkSourceFile) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                imageWatermarkSourceData = e.target.result;
                updateImageWatermarkPreview();
            };
            reader.readAsDataURL(imageWatermarkSourceFile);
        }

        function toggleImageWatermarkType() {
            const type = document.querySelector('input[name="imgWatermarkType"]:checked').value;
            const textOptions = document.getElementById('imgTextWatermarkOptions');
            const imageOptions = document.getElementById('imgImageWatermarkOptions');
            
            if (type === 'text') {
                textOptions.style.display = 'block';
                imageOptions.style.display = 'none';
            } else {
                textOptions.style.display = 'none';
                imageOptions.style.display = 'block';
            }
            
            updateImageWatermarkPreview();
        }

        function handleImgWatermarkLogoSelect(e) {
            const file = e.target.files[0];
            if (file) {
                imgWatermarkLogoFile = file;
                const reader = new FileReader();
                reader.onload = function(event) {
                    imgWatermarkLogoData = event.target.result;
                    updateImageWatermarkPreview();
                };
                reader.readAsDataURL(file);
            }
        }

        function updateImageWatermarkPreview() {
            if (!imageWatermarkSourceData) return;
            
            const canvas = document.getElementById('imgWatermarkPreview');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            
            img.onload = function() {
                const scale = Math.min(canvas.width / img.width, canvas.height / img.height);
                const w = img.width * scale;
                const h = img.height * scale;
                const x = (canvas.width - w) / 2;
                const y = (canvas.height - h) / 2;
                
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(img, x, y, w, h);
                
                const type = document.querySelector('input[name="imgWatermarkType"]:checked').value;
                
                if (type === 'text') {
                    const text = document.getElementById('imgWatermarkText').value || 'SAMPLE';
                    const color = document.getElementById('imgWatermarkColor').value;
                    const opacity = parseFloat(document.getElementById('imgWatermarkOpacity').value) / 100;
                    const fontSize = parseInt(document.getElementById('imgWatermarkSize').value);
                    const position = document.getElementById('imgWatermarkPosition').value;
                    
                    ctx.save();
                    ctx.globalAlpha = opacity;
                    ctx.font = `bold ${fontSize * scale}px Arial`;
                    ctx.fillStyle = color;
                    ctx.strokeStyle = color === '#ffffff' ? '#000000' : '#ffffff';
                    ctx.lineWidth = 2;
                    
                    const textWidth = ctx.measureText(text).width;
                    let textX, textY;
                    
                    if (position === 'center-diagonal') {
                        textX = canvas.width / 2;
                        textY = canvas.height / 2;
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        ctx.translate(textX, textY);
                        ctx.rotate(45 * Math.PI / 180);
                        ctx.strokeText(text, 0, 0);
                        ctx.fillText(text, 0, 0);
                    } else {
                        switch(position) {
                            case 'center':
                                textX = canvas.width / 2;
                                textY = canvas.height / 2;
                                ctx.textAlign = 'center';
                                ctx.textBaseline = 'middle';
                                break;
                            case 'top-left':
                                textX = x + 20;
                                textY = y + fontSize * scale;
                                ctx.textAlign = 'left';
                                ctx.textBaseline = 'top';
                                break;
                            case 'top-right':
                                textX = x + w - 20;
                                textY = y + fontSize * scale;
                                ctx.textAlign = 'right';
                                ctx.textBaseline = 'top';
                                break;
                            case 'bottom-left':
                                textX = x + 20;
                                textY = y + h - 20;
                                ctx.textAlign = 'left';
                                ctx.textBaseline = 'bottom';
                                break;
                            case 'bottom-right':
                                textX = x + w - 20;
                                textY = y + h - 20;
                                ctx.textAlign = 'right';
                                ctx.textBaseline = 'bottom';
                                break;
                        }
                        ctx.strokeText(text, textX, textY);
                        ctx.fillText(text, textX, textY);
                    }
                    ctx.restore();
                } else if (type === 'image' && imgWatermarkLogoData) {
                    const logo = new Image();
                    logo.onload = function() {
                        const opacity = parseFloat(document.getElementById('imgLogoOpacity').value) / 100;
                        const logoScale = parseFloat(document.getElementById('imgLogoScale').value) / 100;
                        const position = document.getElementById('imgLogoPosition').value;
                        
                        const logoW = logo.width * logoScale * scale;
                        const logoH = logo.height * logoScale * scale;
                        
                        ctx.save();
                        ctx.globalAlpha = opacity;
                        
                        if (position === 'center-diagonal') {
                            ctx.translate(canvas.width / 2, canvas.height / 2);
                            ctx.rotate(45 * Math.PI / 180);
                            ctx.drawImage(logo, -logoW / 2, -logoH / 2, logoW, logoH);
                        } else {
                            let logoX, logoY;
                            switch(position) {
                                case 'center':
                                    logoX = (canvas.width - logoW) / 2;
                                    logoY = (canvas.height - logoH) / 2;
                                    break;
                                case 'top-left':
                                    logoX = x + 20;
                                    logoY = y + 20;
                                    break;
                                case 'top-right':
                                    logoX = x + w - logoW - 20;
                                    logoY = y + 20;
                                    break;
                                case 'bottom-left':
                                    logoX = x + 20;
                                    logoY = y + h - logoH - 20;
                                    break;
                                case 'bottom-right':
                                    logoX = x + w - logoW - 20;
                                    logoY = y + h - logoH - 20;
                                    break;
                            }
                            ctx.drawImage(logo, logoX, logoY, logoW, logoH);
                        }
                        ctx.restore();
                    };
                    logo.src = imgWatermarkLogoData;
                }
            };
            
            img.src = imageWatermarkSourceData;
        }

        async function processImageWatermark() {
            const btn = document.getElementById('imgWatermarkBtn');
            btn.disabled = true;
            
            try {
                showStatus('imagewatermark', ' Processing image...', false);
                
                const type = document.querySelector('input[name="imgWatermarkType"]:checked').value;
                const img = new Image();
                
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    canvas.width = img.width;
                    canvas.height = img.height;
                    const ctx = canvas.getContext('2d');
                    
                    ctx.drawImage(img, 0, 0);
                    
                    if (type === 'text') {
                        const text = document.getElementById('imgWatermarkText').value || 'WATERMARK';
                        const color = document.getElementById('imgWatermarkColor').value;
                        const opacity = parseFloat(document.getElementById('imgWatermarkOpacity').value) / 100;
                        const fontSize = parseInt(document.getElementById('imgWatermarkSize').value);
                        const position = document.getElementById('imgWatermarkPosition').value;
                        
                        ctx.save();
                        ctx.globalAlpha = opacity;
                        ctx.font = `bold ${fontSize}px Arial`;
                        ctx.fillStyle = color;
                        ctx.strokeStyle = color === '#ffffff' ? '#000000' : '#ffffff';
                        ctx.lineWidth = 3;
                        
                        const textWidth = ctx.measureText(text).width;
                        let textX, textY;
                        
                        if (position === 'center-diagonal') {
                            textX = canvas.width / 2;
                            textY = canvas.height / 2;
                            ctx.textAlign = 'center';
                            ctx.textBaseline = 'middle';
                            ctx.translate(textX, textY);
                            ctx.rotate(45 * Math.PI / 180);
                            ctx.strokeText(text, 0, 0);
                            ctx.fillText(text, 0, 0);
                        } else {
                            switch(position) {
                                case 'center':
                                    textX = canvas.width / 2;
                                    textY = canvas.height / 2;
                                    ctx.textAlign = 'center';
                                    ctx.textBaseline = 'middle';
                                    break;
                                case 'top-left':
                                    textX = 30;
                                    textY = fontSize + 30;
                                    ctx.textAlign = 'left';
                                    ctx.textBaseline = 'top';
                                    break;
                                case 'top-right':
                                    textX = canvas.width - 30;
                                    textY = fontSize + 30;
                                    ctx.textAlign = 'right';
                                    ctx.textBaseline = 'top';
                                    break;
                                case 'bottom-left':
                                    textX = 30;
                                    textY = canvas.height - 30;
                                    ctx.textAlign = 'left';
                                    ctx.textBaseline = 'bottom';
                                    break;
                                case 'bottom-right':
                                    textX = canvas.width - 30;
                                    textY = canvas.height - 30;
                                    ctx.textAlign = 'right';
                                    ctx.textBaseline = 'bottom';
                                    break;
                            }
                            ctx.strokeText(text, textX, textY);
                            ctx.fillText(text, textX, textY);
                        }
                        ctx.restore();
                        
                        downloadCanvasAsImage(canvas);
                    } else if (imgWatermarkLogoData) {
                        const logo = new Image();
                        logo.onload = function() {
                            const opacity = parseFloat(document.getElementById('imgLogoOpacity').value) / 100;
                            const logoScale = parseFloat(document.getElementById('imgLogoScale').value) / 100;
                            const position = document.getElementById('imgLogoPosition').value;
                            
                            const logoW = logo.width * logoScale;
                            const logoH = logo.height * logoScale;
                            
                            ctx.save();
                            ctx.globalAlpha = opacity;
                            
                            if (position === 'center-diagonal') {
                                ctx.translate(canvas.width / 2, canvas.height / 2);
                                ctx.rotate(45 * Math.PI / 180);
                                ctx.drawImage(logo, -logoW / 2, -logoH / 2, logoW, logoH);
                            } else {
                                let logoX, logoY;
                                switch(position) {
                                    case 'center':
                                        logoX = (canvas.width - logoW) / 2;
                                        logoY = (canvas.height - logoH) / 2;
                                        break;
                                    case 'top-left':
                                        logoX = 30;
                                        logoY = 30;
                                        break;
                                    case 'top-right':
                                        logoX = canvas.width - logoW - 30;
                                        logoY = 30;
                                        break;
                                    case 'bottom-left':
                                        logoX = 30;
                                        logoY = canvas.height - logoH - 30;
                                        break;
                                    case 'bottom-right':
                                        logoX = canvas.width - logoW - 30;
                                        logoY = canvas.height - logoH - 30;
                                        break;
                                }
                                ctx.drawImage(logo, logoX, logoY, logoW, logoH);
                            }
                            ctx.restore();
                            
                            downloadCanvasAsImage(canvas);
                        };
                        logo.src = imgWatermarkLogoData;
                    } else {
                        throw new Error('Please select a watermark logo!');
                    }
                };
                
                img.src = imageWatermarkSourceData;
                
            } catch (error) {
                console.error('Image watermark error:', error);
                showStatus('imagewatermark', ' Error: ' + error.message, true);
                btn.disabled = false;
            }
        }

        function downloadCanvasAsImage(canvas) {
            canvas.toBlob(function(blob) {
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'watermarked-image.png';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                showStatus('imagewatermark', ' Watermark added successfully!', false);
                document.getElementById('imgWatermarkBtn').disabled = false;
            });
        }

        // Header & Footer functions
        function toggleHeaderFooter(type) {
            const enabled = document.getElementById('enable' + type.charAt(0).toUpperCase() + type.slice(1)).checked;
            const options = document.getElementById(type + 'Options');
            options.style.display = enabled ? 'block' : 'none';
        }

        function setProcessingMode(mode) {
            processingMode = mode;
            
            // Update UI
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const singleSection = document.getElementById('singleUploadSection');
            const batchSection = document.getElementById('batchUploadSection');
            const batchInfo = document.getElementById('batchInfo');
            
            if (mode === 'single') {
                singleSection.style.display = 'block';
                batchSection.style.display = 'none';
                batchInfo.classList.remove('show');
                
                // Clear batch files if switching to single mode
                if (headerFooterFiles.length > 1) {
                    headerFooterFiles = headerFooterFiles.slice(0, 1);
                    displayFiles('headerfooter');
                }
            } else {
                singleSection.style.display = 'none';
                batchSection.style.display = 'block';
                batchInfo.classList.add('show');
            }
            
            displayFiles('headerfooter');
        }

        async function addHeaderFooter() {
            const btn = document.getElementById('headerFooterBtn');
            btn.disabled = true;
            
            try {
                const enableHeader = document.getElementById('enableHeader')?.checked || false;
                const enableFooter = document.getElementById('enableFooter')?.checked || false;
                
                if (!enableHeader && !enableFooter) {
                    showStatus('headerfooter', ' Please enable at least header or footer!', true);
                    btn.disabled = false;
                    return;
                }
                
                if (headerFooterFiles.length === 0) {
                    showStatus('headerfooter', ' Please upload at least one PDF file!', true);
                    btn.disabled = false;
                    return;
                }
                
                showStatus('headerfooter', ' Processing...', false);
                updateProgress('headerfooter', 5);
                
                // Get header settings
                let headerText = '';
                let headerLink = '';
                let headerColor = '#000000';
                let headerSize = 12;
                let headerAlign = 'center';
                
                if (enableHeader) {
                    headerText = document.getElementById('headerText')?.value?.trim() || '';
                    headerLink = document.getElementById('headerLink')?.value?.trim() || '';
                    headerColor = document.getElementById('headerColor')?.value || '#000000';
                    headerSize = parseInt(document.getElementById('headerSize')?.value) || 12;
                    headerAlign = document.getElementById('headerAlignment')?.value || 'center';
                }
                
                // Get footer settings
                let footerText = '';
                let footerColor = '#666666';
                let footerSize = 10;
                let footerAlign = 'center';
                
                if (enableFooter) {
                    footerText = document.getElementById('footerText')?.value?.trim() || '';
                    footerColor = document.getElementById('footerColor')?.value || '#666666';
                    footerSize = parseInt(document.getElementById('footerSize')?.value) || 10;
                    footerAlign = document.getElementById('footerAlignment')?.value || 'center';
                }
                
                // Process files based on mode
                if (processingMode === 'single' || headerFooterFiles.length === 1) {
                    // Single file processing
                    const file = headerFooterFiles[0];
                    showStatus('headerfooter', ` Processing ${file.name}...`, false);
                    
                    const modifiedPdfBytes = await processSingleFile(
                        file, 
                        { 
                            enableHeader: enableHeader,
                            headerText: headerText,
                            headerLink: headerLink,
                            headerColor: headerColor,
                            headerSize: headerSize,
                            headerAlign: headerAlign
                        },
                        { 
                            enableFooter: enableFooter,
                            footerText: footerText,
                            footerColor: footerColor,
                            footerSize: footerSize,
                            footerAlign: footerAlign
                        }
                    );
                    
                    updateProgress('headerfooter', 90);
                    
                    // Download single file
                    downloadFile(modifiedPdfBytes, getFileName(file.name, 'with-header-footer'));
                    
                    updateProgress('headerfooter', 100);
                    showStatus('headerfooter', ' Header/Footer added successfully!', false);
                } else {
                    // Batch processing
                    showStatus('headerfooter', ` Processing ${headerFooterFiles.length} files...`, false);
                    
                    const zip = new JSZip();
                    let processedCount = 0;
                    
                    for (let i = 0; i < headerFooterFiles.length; i++) {
                        const file = headerFooterFiles[i];
                        const progress = Math.min(5 + (i / headerFooterFiles.length) * 85, 90);
                        updateProgress('headerfooter', progress);
                        
                        showStatus('headerfooter', ` Processing ${i + 1}/${headerFooterFiles.length}: ${file.name}`, false);
                        
                        try {
                            const modifiedPdfBytes = await processSingleFile(
                                file,
                                { 
                                    enableHeader: enableHeader,
                                    headerText: headerText,
                                    headerLink: headerLink,
                                    headerColor: headerColor,
                                    headerSize: headerSize,
                                    headerAlign: headerAlign
                                },
                                { 
                                    enableFooter: enableFooter,
                                    footerText: footerText,
                                    footerColor: footerColor,
                                    footerSize: footerSize,
                                    footerAlign: footerAlign
                                }
                            );
                            
                            // Add to zip
                            const fileName = getFileName(file.name, 'with-header-footer');
                            zip.file(fileName, modifiedPdfBytes);
                            processedCount++;
                            
                        } catch (error) {
                            console.error(`Error processing ${file.name}:`, error);
                            showStatus('headerfooter', ` Skipped ${file.name}: ${error.message}`, false);
                        }
                    }
                    
                    updateProgress('headerfooter', 95);
                    showStatus('headerfooter', ' Creating ZIP file...', false);
                    
                    // Generate ZIP
                    const zipContent = await zip.generateAsync({ type: "blob" });
                    
                    updateProgress('headerfooter', 100);
                    
                    // Download ZIP
                    const url = URL.createObjectURL(zipContent);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `processed-pdfs-${new Date().getTime()}.zip`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                    
                    showStatus('headerfooter', ` Processed ${processedCount} files successfully! ZIP downloaded.`, false);
                }
                
            } catch (error) {
                console.error('Header/Footer error:', error);
                showStatus('headerfooter', ' Error: ' + error.message, true);
            } finally {
                hideProgress('headerfooter');
                btn.disabled = false;
            }
        }

        async function processSingleFile(file, headerSettings, footerSettings) {
            const fileData = await file.arrayBuffer();
            const pdfDoc = await PDFDocument.load(fileData, {
                ignoreEncryption: true,
                updateMetadata: false
            });
            
            const pages = pdfDoc.getPages();
            const font = await pdfDoc.embedFont('Helvetica');
            
            // Process each page
            pages.forEach((page, index) => {
                const { width, height } = page.getSize();
                const pageNum = index + 1;
                
                // Add Header
                if (headerSettings.enableHeader && headerSettings.headerText) {
                    const textWidth = font.widthOfTextAtSize(headerSettings.headerText, headerSettings.headerSize);
                    let x;
                    
                    switch(headerSettings.headerAlign) {
                        case 'left':
                            x = 30;
                            break;
                        case 'center':
                            x = (width - textWidth) / 2;
                            break;
                        case 'right':
                            x = width - textWidth - 30;
                            break;
                        default:
                            x = (width - textWidth) / 2;
                    }
                    
                    const y = height - 30;
                    
                    // Parse color
                    const hColor = headerSettings.headerColor;
                    const headerColor = {
                        r: parseInt(hColor.substr(1, 2), 16) / 255,
                        g: parseInt(hColor.substr(3, 2), 16) / 255,
                        b: parseInt(hColor.substr(5, 2), 16) / 255
                    };
                    
                    // If link is provided, add annotation
                    if (headerSettings.headerLink) {
                        page.drawText(headerSettings.headerText, {
                            x: x,
                            y: y,
                            size: headerSettings.headerSize,
                            font: font,
                            color: rgb(headerColor.r, headerColor.g, headerColor.b)
                        });
                        
                        // Add link annotation
                        const textHeight = font.heightAtSize(headerSettings.headerSize);
                        page.node.set(PDFLib.PDFName.of('Annots'), pdfDoc.context.obj([
                            pdfDoc.context.obj({
                                Type: 'Annot',
                                Subtype: 'Link',
                                Rect: [x, y, x + textWidth, y + textHeight],
                                Border: [0, 0, 0],
                                A: {
                                    S: 'URI',
                                    URI: PDFLib.PDFString.of(headerSettings.headerLink)
                                }
                            })
                        ]));
                    } else {
                        page.drawText(headerSettings.headerText, {
                            x: x,
                            y: y,
                            size: headerSettings.headerSize,
                            font: font,
                            color: rgb(headerColor.r, headerColor.g, headerColor.b)
                        });
                    }
                }
                
                // Add Footer - FIXED: Check only if footer is enabled
                if (footerSettings.enableFooter) {
                    // Get footer text (might be empty)
                    let footerText = footerSettings.footerText || '';
                    
                    // If there's text, process it
                    if (footerText) {
                        // Replace {page} with actual page number
                        footerText = footerText.replace(/{page}/g, pageNum.toString());
                        
                        const textWidth = font.widthOfTextAtSize(footerText, footerSettings.footerSize);
                        let x;
                        
                        switch(footerSettings.footerAlign) {
                            case 'left':
                                x = 30;
                                break;
                            case 'center':
                                x = (width - textWidth) / 2;
                                break;
                            case 'right':
                                x = width - textWidth - 30;
                                break;
                            default:
                                x = (width - textWidth) / 2;
                        }
                        
                        // Parse color
                        const fColor = footerSettings.footerColor;
                        const footerColor = {
                            r: parseInt(fColor.substr(1, 2), 16) / 255,
                            g: parseInt(fColor.substr(3, 2), 16) / 255,
                            b: parseInt(fColor.substr(5, 2), 16) / 255
                        };
                        
                        page.drawText(footerText, {
                            x: x,
                            y: 20,
                            size: footerSettings.footerSize,
                            font: font,
                            color: rgb(footerColor.r, footerColor.g, footerColor.b)
                        });
                    }
                }
            });
            
            return await pdfDoc.save();
        }

        function getFileName(originalName, suffix) {
            const nameWithoutExt = originalName.replace(/\.pdf$/i, '');
            return `${nameWithoutExt}-${suffix}.pdf`;
        }

        function downloadFile(data, fileName) {
            const blob = new Blob([data], { type: 'application/pdf' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = fileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize watermark preview
            updateWatermarkPreview();
            
            // Set default processing mode
            setProcessingMode('single');
            
            console.log('PDF Master Pro initialized successfully!');
        });
    </script>
</body>
</html>
